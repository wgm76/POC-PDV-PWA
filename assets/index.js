import g,{useState as u,useEffect as b}from"https://cdn.skypack.dev/react";import P from"https://cdn.skypack.dev/react-dom/client";import{jsxs as m,jsx as r}from"https://cdn.skypack.dev/react/jsx-runtime";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();let p=null;const S=async()=>{try{p=await window.showDirectoryPicker(),localStorage.setItem("directoryHandle",await p.requestPermission()),alert("Pasta selecionada! Agora os arquivos podem ser salvos diretamente.")}catch(t){console.error("Erro ao selecionar pasta:",t),alert("Erro ao selecionar pasta. Verifique as permissões.")}},C=async()=>{try{const t=localStorage.getItem("directoryHandle");t&&(p=await window.navigator.storage.getDirectory(t))}catch(t){console.error("Erro ao recuperar diretório salvo:",t)}},O=async(t,c)=>{try{if(!p){alert("Selecione uma pasta primeiro!");return}const l=await(await p.getFileHandle(t,{create:!0})).createWritable();await l.write(c),await l.close(),alert(`Arquivo "${t}" salvo com sucesso!`)}catch(n){console.error("Erro ao salvar o arquivo:",n)}},L=()=>{const[t,c]=u(null),[n,l]=u(null),[a,o]=u("---"),[s,w]=u(""),[f,y]=u("");return b(()=>{C()},[]),m("div",{children:[r("h1",{children:"Gravação de Arquivo no PWA"}),r("button",{onClick:S,children:"Selecionar Pasta"}),r("button",{onClick:()=>O("meuArquivo.txt","Teste gravando arquivo no disco"),children:"Salvar Arquivo"}),r("hr",{}),r("h2",{children:"Impressora Térmica (Serial)"}),r("label",{children:"Selecionar Porta Impressora:"}),m("select",{onChange:e=>w(e.target.value),children:[r("option",{value:"",children:"--Selecione a Porta--"}),r("option",{value:"COM1",children:"COM1"}),r("option",{value:"COM2",children:"COM2"}),r("option",{value:"COM5",children:"COM5"})]}),r("button",{onClick:async()=>{if(!s){alert("Selecione uma porta serial para a impressora.");return}try{const e=await navigator.serial.requestPort();await e.open({baudRate:9600,dataBits:8,stopBits:1,parity:"none",flowControl:"none"}),c(e),alert(`Impressora conectada na porta ${s}`)}catch(e){console.error("Erro ao conectar à impressora:",e),alert("Falha ao conectar à impressora.")}},disabled:!s,children:"Conectar Impressora"}),r("button",{onClick:async()=>{if(!t){alert("Nenhuma impressora conectada.");return}try{const e=t.writable.getWriter(),d=t.readable.getReader(),h=new Uint8Array([1,0,20,0,2,0,48,124,194]);await e.write(h);let{value:i}=await d.read();if(i[0]!==6){alert("Impressora não reconheceu o comando."),e.releaseLock(),d.releaseLock();return}await e.write(new Uint8Array([5,0])),{value:i}=await d.read(),console.log("Status recebido:",i),await e.write(new Uint8Array([5,0])),{value:i}=await d.read(),console.log("Resposta final:",i),e.releaseLock(),d.releaseLock(),alert("Leitura X enviada com sucesso!")}catch(e){console.error("Erro ao emitir Leitura X:",e),alert("Falha ao emitir Leitura X.")}},disabled:!t,children:"Emitir Leitura X"}),r("hr",{}),r("h2",{children:"Balança (Porta Serial)"}),r("label",{children:"Selecionar Porta Balança:"}),m("select",{onChange:e=>y(e.target.value),children:[r("option",{value:"",children:"--Selecione a Porta--"}),r("option",{value:"COM1",children:"COM1"}),r("option",{value:"COM2",children:"COM2"}),r("option",{value:"COM3",children:"COM3"})]}),r("button",{onClick:async()=>{if(!f){alert("Selecione uma porta serial para a balança.");return}try{const e=await navigator.serial.requestPort();await e.open({baudRate:9600}),l(e),alert(`Balança conectada na porta ${f}`)}catch(e){console.error("Erro ao conectar à balança:",e),alert("Falha ao conectar à balança.")}},disabled:!f,children:"Conectar Balança"}),r("button",{onClick:async()=>{if(!n){alert("Nenhuma balança conectada.");return}try{const e=new TextDecoderStream,d=n.readable.pipeTo(e.writable),h=e.readable.getReader();for(;;){const{value:i,done:v}=await h.read();if(v){h.releaseLock();break}i&&o(i.trim())}}catch(e){console.error("Erro ao ler peso:",e),alert("Falha ao ler peso.")}},disabled:!n,children:"Ler Peso"}),m("p",{children:["Peso: ",a]})]})},M=P.createRoot(document.getElementById("root"));M.render(g.createElement(L));
